<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>websocket | çœ‹é£æ™¯äººçš„åšå®¢</title>
    <meta name="description" content="mark">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/docs/assets/style.C1d1rbdp.css" as="style">
    <link rel="preload stylesheet" href="/docs/vp-icons.css" as="style">
    
    <script type="module" src="/docs/assets/app.YdCEa-gu.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/docs/assets/chunks/theme.CJRL65TO.js">
    <link rel="modulepreload" href="/docs/assets/chunks/framework.DRDiIiLY.js">
    <link rel="modulepreload" href="/docs/assets/webNet_websocket.md.BkqLizDy.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1df9f90f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-331ec75c></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-331ec75c>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1df9f90f data-v-da52a441><div class="VPNavBar" data-v-da52a441 data-v-70946a35><div class="wrapper" data-v-70946a35><div class="container" data-v-70946a35><div class="title" data-v-70946a35><div class="VPNavBarTitle has-sidebar" data-v-70946a35 data-v-1e38c6bc><a class="title" href="/docs/" data-v-1e38c6bc><!--[--><!--]--><!----><span data-v-1e38c6bc>çœ‹é£æ™¯äººçš„åšå®¢</span><!--[--><!--]--></a></div></div><div class="content" data-v-70946a35><div class="content-body" data-v-70946a35><!--[--><!--]--><div class="VPNavBarSearch search" data-v-70946a35><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-70946a35 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/docs/" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>ä¸»é¡µ</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/docs/webNet/websocket.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>websocket</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-70946a35 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-70946a35 data-v-0394ad82 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/kanfengjingren" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-70946a35 data-v-bf2fac68 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-42cb505d><span class="vpi-more-horizontal icon" data-v-42cb505d></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><!----><div class="group" data-v-bf2fac68><div class="item appearance" data-v-bf2fac68><p class="label" data-v-bf2fac68>Appearance</p><div class="appearance-action" data-v-bf2fac68><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bf2fac68 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bf2fac68><div class="item social-links" data-v-bf2fac68><div class="VPSocialLinks social-links-list" data-v-bf2fac68 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/kanfengjingren" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-70946a35 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-70946a35><div class="divider-line" data-v-70946a35></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-1df9f90f data-v-db738f89><div class="container" data-v-db738f89><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-db738f89><span class="vpi-align-left menu-icon" data-v-db738f89></span><span class="menu-text" data-v-db738f89>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-db738f89 data-v-0bf0e06f><button data-v-0bf0e06f>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-1df9f90f data-v-af661f50><div class="curtain" data-v-af661f50></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-af661f50><span class="visually-hidden" id="sidebar-aria-label" data-v-af661f50> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0 has-active" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>webNet</h2><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/docs/webNet/websocket.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>websocket</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/docs/webNet/tcp.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>tcp</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/docs/webNet/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B5%81%E7%A8%8B.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>æµè§ˆå™¨æµç¨‹</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/docs/webNet/SSE.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>SSE</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-8d50c081><section class="VPSidebarItem level-0" data-v-8d50c081 data-v-d81de50c><div class="item" role="button" tabindex="0" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><h2 class="text" data-v-d81de50c>nodejs</h2><!----></div><div class="items" data-v-d81de50c><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d81de50c data-v-d81de50c><div class="item" data-v-d81de50c><div class="indicator" data-v-d81de50c></div><a class="VPLink link link" href="/docs/nodejs/fs.html" data-v-d81de50c><!--[--><p class="text" data-v-d81de50c>fs</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1df9f90f data-v-c87f25bf><div class="VPDoc has-sidebar has-aside" data-v-c87f25bf data-v-7011f0d8><!--[--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>On this page</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-1ce71065><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _docs_webNet_websocket" data-v-7011f0d8><div><h1 id="websocket" tabindex="-1">websocket <a class="header-anchor" href="#websocket" aria-label="Permalink to â€œwebsocketâ€">â€‹</a></h1><h3 id="è¿™ä¸ªæ˜¯ä»€ä¹ˆ" tabindex="-1">è¿™ä¸ªæ˜¯ä»€ä¹ˆï¼Ÿ <a class="header-anchor" href="#è¿™ä¸ªæ˜¯ä»€ä¹ˆ" aria-label="Permalink to â€œè¿™ä¸ªæ˜¯ä»€ä¹ˆï¼Ÿâ€">â€‹</a></h3><p>ä¼ ç»Ÿçš„httpåè®®åªèƒ½å®¢æˆ·ç«¯å•æ–¹é¢å‘é€è¯·æ±‚ï¼Œä¹Ÿæœ‰é€šè¿‡è½®è¯¢çš„æ–¹å¼æ¥å®ç°ä¸¤è¾¹é€šä¿¡ï¼Œä½†æ˜¯è¿™ç§æ“ä½œçš„è¯·æ±‚å’Œå“åº”å¤ªè¿‡äºé¢‘ç¹äº† websocketå¯ä»¥å»ºç«‹èµ·ä¸€ä¸ªä¸ä¼šè‡ªåŠ¨å…³é—­çš„åŒå‘é€šé“ æ€ä¹ˆå»ºç«‹èµ·æŒä¹…çš„é“¾æ¥çš„å‘¢ï¼Ÿ WebSocketé€šè¿‡TCPè¿æ¥æ¥ä¿æŒæŒä¹…è¿æ¥ã€‚TCPæ˜¯ä¸€ä¸ªé¢å‘è¿æ¥çš„åè®®ï¼Œå®ƒåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªç¨³å®šçš„è¿æ¥ï¼Œç›´åˆ°ä¸»åŠ¨æ–­å¼€ã€‚å› æ­¤ï¼ŒWebSocketåˆ©ç”¨TCPçš„ç‰¹æ€§ä¿æŒè¿æ¥æŒç»­å¼€æ”¾ã€‚</p><h2 id="ä½¿ç”¨nodejsæ­å»ºä¸€ä¸ªç®€å•çš„websocket" tabindex="-1">ä½¿ç”¨nodejsæ­å»ºä¸€ä¸ªç®€å•çš„websocket <a class="header-anchor" href="#ä½¿ç”¨nodejsæ­å»ºä¸€ä¸ªç®€å•çš„websocket" aria-label="Permalink to â€œä½¿ç”¨nodejsæ­å»ºä¸€ä¸ªç®€å•çš„websocketâ€">â€‹</a></h2><p>æœåŠ¡ç«¯ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>// å¼•å…¥WebSocketæœåŠ¡å™¨åº“</span></span>
<span class="line"><span>const WebSocket = require(&#39;ws&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// åˆ›å»ºä¸€ä¸ªWebSocketæœåŠ¡å™¨ï¼Œç›‘å¬8080ç«¯å£</span></span>
<span class="line"><span>const wss = new WebSocket.Server({ port: 8080 });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// å½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶</span></span>
<span class="line"><span>wss.on(&#39;connection&#39;, function connection(ws) {</span></span>
<span class="line"><span>  console.log(&#39;æ–°çš„å®¢æˆ·ç«¯è¿æ¥&#39;);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // å½“æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯æ—¶</span></span>
<span class="line"><span>  ws.on(&#39;message&#39;, function incoming(message) {</span></span>
<span class="line"><span>    console.log(&#39;æ”¶åˆ°æ¶ˆæ¯: %s&#39;, message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    // å°†æ”¶åˆ°çš„æ¶ˆæ¯å›æ˜¾ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span>    ws.send(`æœåŠ¡å™¨æ”¶åˆ°ï¼š${message}`);</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // å½“è¿æ¥å…³é—­æ—¶</span></span>
<span class="line"><span>  ws.on(&#39;close&#39;, function close() {</span></span>
<span class="line"><span>    console.log(&#39;å®¢æˆ·ç«¯æ–­å¼€è¿æ¥&#39;);</span></span>
<span class="line"><span>  });</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  // å‘é€ä¸€æ¡æ¬¢è¿æ¶ˆæ¯ç»™å®¢æˆ·ç«¯</span></span>
<span class="line"><span>  ws.send(&#39;æ¬¢è¿è¿æ¥WebSocketæœåŠ¡å™¨ï¼&#39;);</span></span>
<span class="line"><span>});</span></span>
<span class="line"><span></span></span>
<span class="line"><span>console.log(&#39;WebSocketæœåŠ¡å™¨æ­£åœ¨è¿è¡Œåœ¨ ws://localhost:8080&#39;);</span></span></code></pre></div><p>å®¢æˆ·ç«¯åˆ›å»ºwebsocketå¯¹è±¡ç„¶åè¿›è¡Œé“¾æ¥ï¼š</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>&lt;body&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    &lt;div&gt;</span></span>
<span class="line"><span>        &lt;input type=&quot;text&quot;&gt;</span></span>
<span class="line"><span>        &lt;button&gt;ç‚¹å‡»å‘é€ä¿¡æ¯&lt;/button&gt;</span></span>
<span class="line"><span>    &lt;/div&gt;</span></span>
<span class="line"><span>    &lt;div class=&quot;container&quot;&gt;&lt;/div&gt;</span></span>
<span class="line"><span>&lt;/body&gt;</span></span>
<span class="line"><span>&lt;script&gt;</span></span>
<span class="line"><span>    const btn = document.querySelector(&#39;button&#39;);</span></span>
<span class="line"><span>    const input = document.querySelector(&#39;input&#39;);</span></span>
<span class="line"><span>    const container = document.querySelector(&#39;.container&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    const socket = new WebSocket(&#39;ws://localhost:8080&#39;);</span></span>
<span class="line"><span>    socket.addEventListener(&#39;open&#39;, () =&gt; {</span></span>
<span class="line"><span>        socket.send(&#39;å·²è¿æ¥åˆ°æœåŠ¡å™¨&#39;)</span></span>
<span class="line"><span>    })</span></span>
<span class="line"><span>    socket.addEventListener(&#39;message&#39;,(e)=&gt;{</span></span>
<span class="line"><span>        addMessage(&#39;æœåŠ¡ç«¯ï¼š&#39;+e.data);</span></span>
<span class="line"><span>    })</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    btn.onclick = function () {</span></span>
<span class="line"><span>        let str = input.value;</span></span>
<span class="line"><span>        socket.send(str);</span></span>
<span class="line"><span>        addMessage(&#39;æˆ‘ï¼š&#39;+str)</span></span>
<span class="line"><span>        input.value = &#39;&#39;;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    function addMessage(str){</span></span>
<span class="line"><span>        const client = document.createElement(&#39;div&#39;);</span></span>
<span class="line"><span>        client.innerHTML = str;</span></span>
<span class="line"><span>        container.appendChild(client);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;/script&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&lt;/html&gt;</span></span></code></pre></div><p><strong>åŸç†ï¼š</strong>åº”è¯¥æ˜¯åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™åœ¨è¯·æ±‚å¤´ä¸Šå¸¦ä¸Šäº†å‡çº§åè®®çš„æ ‡è¯† <img src="/docs/assets/%E8%AF%B7%E6%B1%82%E5%A4%B4%E6%A0%87%E8%AF%86.CtyStcd6.png" alt=""></p><p>ç°åœ¨è¿™ä¸ªè¿˜åªæ˜¯å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘èƒ½ä¸èƒ½å¤šåŠ å…¥å‡ ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™æ ·æ¯ä¸ªå®¢æˆ·ç«¯å°±èƒ½èŠå¤©äº†ï¼Œæ˜å¤©è¯•è¯•</p><h2 id="jsä¸­çš„websocketå¯¹è±¡" tabindex="-1">jsä¸­çš„websocketå¯¹è±¡ <a class="header-anchor" href="#jsä¸­çš„websocketå¯¹è±¡" aria-label="Permalink to â€œjsä¸­çš„websocketå¯¹è±¡â€">â€‹</a></h2><p>ç›´æ¥ä½¿ç”¨websocketå°±èƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ <code>new WebSocket(url, protocols)</code> protocolså¯ä»¥é€‰æ‹©ä¼ ä¸ä¼ å…¥ï¼Œè¿™ä¸ªå¯ä»¥æŒ‡å®šwebsocketä¸åŒçš„å­åè®®</p><h3 id="å®ä¾‹æ–¹æ³•" tabindex="-1">å®ä¾‹æ–¹æ³• <a class="header-anchor" href="#å®ä¾‹æ–¹æ³•" aria-label="Permalink to â€œå®ä¾‹æ–¹æ³•â€">â€‹</a></h3><h4 id="close" tabindex="-1">close <a class="header-anchor" href="#close" aria-label="Permalink to â€œcloseâ€">â€‹</a></h4><p>ä½¿ç”¨åå…³é—­é€šé“</p><h4 id="send" tabindex="-1">send <a class="header-anchor" href="#send" aria-label="Permalink to â€œsendâ€">â€‹</a></h4><p>å¯ä»¥å‘é€æ¶ˆæ¯</p><h2 id="websocketæœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ ¼å¼-å­˜ç–‘" tabindex="-1">websocketæœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ ¼å¼ å­˜ç–‘ <a class="header-anchor" href="#websocketæœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ ¼å¼-å­˜ç–‘" aria-label="Permalink to â€œwebsocketæœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ ¼å¼   å­˜ç–‘â€">â€‹</a></h2><p>æœåŠ¡ç«¯åªèƒ½æ¥æ”¶åˆ°bufferå’Œstringçš„ã€‚ æˆ‘åœ¨å®¢æˆ·ç«¯æƒ³è¦å‘é€ä¸€ä¸ªobjectï¼Œä½¿ç”¨JSON.stringfyè½¬åŒ–ä¹‹åå˜æˆäº†JSONå­—ç¬¦ä¸²ï¼Œå‘é€çš„æ—¶å€™ä¼šå˜æˆäºŒè¿›åˆ¶bufferç„¶åæœåŠ¡ç«¯æ”¶åˆ°çš„æ˜¯bufferï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥JSON.parse éœ€è¦å…ˆè½¬åŒ–æˆå­—ç¬¦ä¸²ç„¶åå†è§£æ</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>    let dataStr = data.toString(&#39;utf-8&#39;);</span></span>
<span class="line"><span>    dataStr = JSON.parse(dataStr)</span></span>
<span class="line"><span>    console.log(`æ”¶åˆ°${dataStr.Id}æ¶ˆæ¯: %s`, dataStr.message);</span></span></code></pre></div><h2 id="websocketå®ç°å¹¿æ’­" tabindex="-1">websocketå®ç°å¹¿æ’­ <a class="header-anchor" href="#websocketå®ç°å¹¿æ’­" aria-label="Permalink to â€œwebsocketå®ç°å¹¿æ’­â€">â€‹</a></h2><p>æœåŠ¡ç«¯åˆ›å»ºwebsocketæœåŠ¡å™¨ç›‘å¬çª—å£æ—¶ï¼Œæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæœåŠ¡ç«¯çš„wss</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>const wss = new WebSocket.Server({ port: 8080 });</span></span></code></pre></div><p>æ¥ç€åœ¨å»ºç«‹é“¾æ¥çš„æ—¶å€™ï¼Œå›è°ƒå‡½æ•°é‡Œé¢éœ€è¦ä¼ å…¥wså³å®¢æˆ·ç«¯å¯¹è±¡</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>wss.on(&#39;connection&#39;, function connection(ws) {})</span></span></code></pre></div><p><strong>å¦‚æœå¼€äº†å¾ˆå¤šä¸ªå®¢æˆ·ç«¯ï¼Œå°±å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œæ“ä½œï¼š</strong>å› ä¸ºæ–°å»ºç«‹ä¸€ä¸ªé“¾æ¥å°±ä¼šæœ‰æ–°çš„wsä¼ è¿›æ¥ï¼Œæ‰€ä»¥è¦å®ç°å¤šäººé€šè¯ï¼Œå¯ä»¥ä½¿ç”¨Mapé›†åˆæŠŠwsä¿å­˜èµ·æ¥ å¹¶ä¸”è®¾ç½®clientIdä½œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çš„å”¯ä¸€è¯†åˆ«ç¬¦</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>    //æŠŠè¿™ä¸ªå®¢æˆ·ç«¯çš„idè®°å½•ä¸‹æ¥</span></span>
<span class="line"><span>    const clientId = `å®¢æˆ·ç«¯_${clientCount++}`;</span></span>
<span class="line"><span>    clientMap.set(clientId, ws);</span></span></code></pre></div><h3 id="æ¥æ”¶å¹¶å¹¿æ’­æ¶ˆæ¯" tabindex="-1">æ¥æ”¶å¹¶å¹¿æ’­æ¶ˆæ¯ <a class="header-anchor" href="#æ¥æ”¶å¹¶å¹¿æ’­æ¶ˆæ¯" aria-label="Permalink to â€œæ¥æ”¶å¹¶å¹¿æ’­æ¶ˆæ¯â€">â€‹</a></h3><p>å®ä¾‹é‡Œé¢æœ‰ä¸ªclientså»ç»Ÿè®¡æœ‰å‡ ä¸ªå®¢æˆ·ç«¯è¿æ¥</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>    ws.on(&#39;message&#39;, function incoming(data) {</span></span>
<span class="line"><span>        let dataStr = data.toString(&#39;utf-8&#39;);</span></span>
<span class="line"><span>        dataStr = JSON.parse(dataStr)</span></span>
<span class="line"><span>        console.log(`æ”¶åˆ°${dataStr.Id}æ¶ˆæ¯: %s`, dataStr.message);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //å‘å…¶ä»–å®¢æˆ·ç«¯å¹¿æ’­è¿™ä¸ªæ¶ˆæ¯</span></span>
<span class="line"><span>        //å°±å‘è¿™ä¸ªå®¢æˆ·ç«¯å‘é€ä¿¡æ¯</span></span>
<span class="line"><span>        //å…¶å®æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å—åˆ°ä¿¡æ¯ï¼Œä½†æ˜¯å¦‚æœidæ˜¯è‡ªå·±çš„ï¼Œå®¢æˆ·ç«¯è¿™è¾¹å¤„ç†ä¸€ä¸‹ï¼Œä¸è¦æ‰“å°å‡ºæ¥</span></span>
<span class="line"><span>        //æˆ‘æœ¬æ¥æƒ³çš„æ˜¯éå†é›†åˆï¼Œå‘æ¯ä¸ªéå½“å‰idçš„å®¢æˆ·ç«¯å‘é€ä¸€æ¬¡ä¿¡æ¯ï¼Œä½†æ˜¯è¿™ä¸ªå¥½åƒä¸èƒ½å®ç°</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //æˆ‘å‘ç°äº†ï¼Œè¿™é‡Œåªsendç»™äº†å½“å‰å‘æ¶ˆæ¯çš„å“ªä¸ªäºº</span></span>
<span class="line"><span>        clientMap.forEach((ws,clientId) =&gt; {</span></span>
<span class="line"><span>            if (clientId !== dataStr.Id) {</span></span>
<span class="line"><span>                ws.send(JSON.stringify({</span></span>
<span class="line"><span>                    type: &#39;message&#39;,</span></span>
<span class="line"><span>                    message: dataStr.message,</span></span>
<span class="line"><span>                    clientId: dataStr.Id</span></span>
<span class="line"><span>                }))</span></span>
<span class="line"><span>            }</span></span>
<span class="line"><span>        })</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        //å“¦ï¼Œå½“å‰çš„è¿™ä¸ªwså°±æ˜¯å®¢æˆ·ç«¯ï¼Œä½†æ˜¯æ˜¯å½“å‰çš„å®¢æˆ·ç«¯</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>    });</span></span></code></pre></div><p>åˆšå¼€å§‹æˆ‘ä»¥ä¸ºï¼Œsendæ˜¯å‘æ‰€æœ‰å®¢æˆ·ç«¯å‘é€ï¼ˆå½“æ—¶ä¸çŸ¥é“æ˜¯æœ‰å¤šä¸ªå®¢æˆ·ç«¯çš„ï¼Œæ‰€ä»¥æƒ³ç€ç›´æ¥sendï¼Œç»“æœå‘ç°ï¼Œåªå‘é€ç»™äº†å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯ï¼Œè¿™æ‰çŸ¥é“å®¢æˆ·ç«¯å…¶å®ä¹Ÿæ˜¯è¢«åˆ†å¼€äº†çš„ï¼‰ã€‚æ‰€ä»¥ç°åœ¨ï¼Œéå†Mapé›†åˆï¼Œä½¿ç”¨clientIdå»åˆ†å¼€å®¢æˆ·ç«¯ï¼Œç„¶åå†é€‰æ‹©æ€§å¹¿æ’­ğŸ‘</p></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><!----></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/docs/webNet/tcp.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>tcp</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"DX2oIdxt\",\"nodejs_fs.md\":\"D-a6rCQ4\",\"webnet_sse.md\":\"DOOz4xBc\",\"webnet_tcp.md\":\"CYMDLFIo\",\"webnet_websocket.md\":\"BkqLizDy\",\"webnet_æµè§ˆå™¨æµç¨‹.md\":\"DxFtJRO_\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"çœ‹é£æ™¯äººçš„åšå®¢\",\"description\":\"mark\",\"base\":\"/docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"ä¸»é¡µ\",\"link\":\"/\"},{\"text\":\"websocket\",\"link\":\"/webNet/websocket\"}],\"sidebar\":[{\"text\":\"webNet\",\"items\":[{\"text\":\"websocket\",\"link\":\"/webNet/websocket\"},{\"text\":\"tcp\",\"link\":\"/webNet/tcp\"},{\"text\":\"æµè§ˆå™¨æµç¨‹\",\"link\":\"/webNet/æµè§ˆå™¨æµç¨‹\"},{\"text\":\"SSE\",\"link\":\"/webNet/SSE\"}]},{\"text\":\"nodejs\",\"items\":[{\"text\":\"fs\",\"link\":\"/nodejs/fs\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/kanfengjingren\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>